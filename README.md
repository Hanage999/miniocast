# miniocast

Amazon S3 互換のクラウドストレージ、MinIO のバケットを Podcast サーバーにしてしまおうという寸法です。

## 動作環境
+ macOS 10.14.4
+ Go 1.12.4
+ MinIO 2019-04-23T23:50:36Z

## 機能
+ バケット内のフォルダを１つの Podcast サイトとし、そこに存在する音声ファイルをもとに、同一フォルダ内に自動的に feed.rss と web.html を生成あるいは更新します。同時に複数の Podcast サイトを更新することも可能です。
+ ファイルの名前をエピソードタイトルとして使います。
+ ファイル名に含まれている最初の半角スペースを区切りとして認識し、区切りの前をタイトル、後を Description として登録します。
+ 区切り以降に「第<半角数字>回」（第023回、第5回など）という文字列が存在する場合は、それを Description ではなく、エピソード番号として認識します。数字は全角ダメ、絶対。
+ タイトルにエピソード番号を自動で追加するよう設定することができます（書式：「第~回」）。新エピソードの番号は、既存フィードに含まれている最終エピソードの番号をインクリメントしたものになります。もし既存の最終エピソードに番号が設定されていなければ、既存のエピソードの数に応じて新エピソードの番号を決定します。最初の feed 作成時にエピソード番号を上述の方法で任意に設定しておき、以後の更新では自動的に設定させる、という使い方が可能です。

## miniocastコマンドの使い方
1. 下準備1：MinIO のバケットと Podcast ごとのフォルダを作成し、バケットには Read Only ポリシーを適用しておく。
1. 下準備2：Podcast にしたいフォルダ直下に、配信したい mp3 もしくは m4a ファイルを置く。
1. 下準備3：Podcast にしたいフォルダ直下に、image.jpg という名前でタイトル画像を設置する。
1. cmd/miniocast フォルダで go get、go build すると、フォルダに miniocast コマンドができる。MinIOサーバーと同じマシンに置く必要はない。（ただ後述の通り、同一マシンに置いておくと、より便利に使える場合もあるかも）
1. config.yml.example を config.yml にリネームまたはコピーし、バケットとフォルダなどの設定に応じて書き換えるあるいは追記する。
1. ./miniocast で起動。

## 作成したPodcastの利用方法

1. 作成した Podcast は iTunes ストア等で検索しても表示されないので、お使いのアプリに RSS フィードの URL：  
**{minioバケットのurl}/{フォルダ名}/feed.rss** を直接登録してください。
1. **{minioバケットのurl}/{フォルダ名}/web.html** にアクセスすると、シンプルな Web インターフェイスを表示することができます。各エピソードのタイトルをクリックすると、プレイヤーが表示されたり隠れたりします。注意：MinIO はウェブサーバではないので、web.html というファイルまで指定しないとサイトが表示されません。
1. web.html は、config.yml で SavePlayState を true にすることにより、ブラウザを閉じたり再読み込みしても各エピソードの再生位置と再生速度を保存することができます。再生状態が保存されているエピソードはタイトルが緑色で表示されます。一時停止中にシークバーで再生位置をゼロに戻せば、保存状態をリセットできます。

## より便利に

たとえば macOS 上で MinIO を運用しているなら、MinIO がサーバーとして使っているローカルフォルダにフォルダアクションを適用できます。

そこで、同一マシンに miniocast と設定ファイルを置き、そのフォルダにファイルが追加されたら miniocast を自動的に起動するような Automator ワークフローを組んでおくと便利です（フォルダやコマンドのアクセス権にご注意）。

## Amazon S3 では

……試しておりません。

## 謝辞

Webインターフェイスのデザインは、[Turing Complete FM](https://turingcomplete.fm)の[Rui Ueyama](https://twitter.com/rui314)さんが気前よく公開してくださっている JavaScript と CSS を使わせていただきました。
